upstream kong-8000 {
    least_conn;
    {{range service "kong"}}
    server {{.Address}}:8000 max_fails=3 fail_timeout=60 weight=1;{{end}}
}

upstream kong-8001 {
    least_conn;
    {{range service "kong"}}
    server {{.Address}}:8001 max_fails=3 fail_timeout=60 weight=1;{{end}}
}

server {
	listen 8000;
	location / {
        proxy_pass http://kong-8000;
    }
}

server {
	listen 8001;
	location / {
        proxy_pass http://kong-8001;
    }
}
